using System.Text;
using NSubstitute;
namespace Practice.Tests;

[TestClass]
public class UnitTest1
{
    [TestMethod]
    public void 測試字串壓縮後是否能正確還原()
    {
        string testStr = "test123";
        StrGZipBase64 gzipBase64 = new StrGZipBase64();
        string zipped = gzipBase64.compress(testStr);
        string unzipped = gzipBase64.decompress(zipped);

        Assert.AreEqual(testStr, unzipped);
    }

    [TestMethod]
    public async Task 測試API_使用Stub()
    {
        RestCountriesStub restCountries = new RestCountriesStub();
        restCountries.ResponseBody = @"[{""name"":{""common"":""Taiwan"",""official"":""Republic of China (Taiwan)"",""nativeName"":{""zho"":{""official"":""中華民國"",""common"":""台灣""}}},""tld"":["".tw"","".台灣"","".台湾""],""cca2"":""TW"",""ccn3"":""158"",""cca3"":""TWN"",""cioc"":""TPE"",""independent"":false,""status"":""officially-assigned"",""unMember"":false,""currencies"":{""TWD"":{""name"":""New Taiwan dollar"",""symbol"":""$""}},""idd"":{""root"":""+8"",""suffixes"":[""86""]},""capital"":[""Taipei""],""altSpellings"":[""TW"",""Táiwān"",""Republic of China"",""中華民國"",""Zhōnghuá Mínguó"",""Chinese Taipei""],""region"":""Asia"",""subregion"":""Eastern Asia"",""languages"":{""zho"":""Chinese""},""translations"":{""ara"":{""official"":""جمهورية الصين (تايوان)"",""common"":""تايوان""},""bre"":{""official"":""Republik Sina (Taiwan)"",""common"":""Taiwan""},""ces"":{""official"":""Čínská republika"",""common"":""Tchaj-wan""},""cym"":{""official"":""Republic of China (Taiwan)"",""common"":""Taiwan""},""deu"":{""official"":""Republik China (Taiwan)"",""common"":""Taiwan""},""est"":{""official"":""Taiwani"",""common"":""Taiwan""},""fin"":{""official"":""Kiinan tasavalta"",""common"":""Taiwan""},""fra"":{""official"":""République de Chine (Taïwan)"",""common"":""Taïwan""},""hrv"":{""official"":""Republika Kina"",""common"":""Tajvan""},""hun"":{""official"":""Kínai Köztársaság"",""common"":""Tajvan""},""ita"":{""official"":""Repubblica cinese (Taiwan)"",""common"":""Taiwan""},""jpn"":{""official"":""中華民国"",""common"":""台湾""},""kor"":{""official"":""중화민국"",""common"":""대만""},""nld"":{""official"":""Republiek China (Taiwan)"",""common"":""Taiwan""},""per"":{""official"":""جمهوری چین"",""common"":""تایوان""},""pol"":{""official"":""Republika Chińska (Tajwan)"",""common"":""Tajwan""},""por"":{""official"":""República da China"",""common"":""Ilha Formosa""},""rus"":{""official"":""Китайская Республика"",""common"":""Тайвань""},""slk"":{""official"":""Čínska republika"",""common"":""Taiwan""},""spa"":{""official"":""República de China en Taiwán"",""common"":""Taiwán""},""srp"":{""official"":""Република Кина"",""common"":""Тајван""},""swe"":{""official"":""Republiken Kina"",""common"":""Taiwan""},""tur"":{""official"":""Çin Cumhuriyeti (Tayvan)"",""common"":""Tayvan""},""urd"":{""official"":""جمہوریہ چین (تائیوان)"",""common"":""تائیوان""}},""latlng"":[23.5,121.0],""landlocked"":false,""area"":36193.0,""demonyms"":{""eng"":{""f"":""Taiwanese"",""m"":""Taiwanese""},""fra"":{""f"":""Taïwanaise"",""m"":""Taïwanais""}},""flag"":""\uD83C\uDDF9\uD83C\uDDFC"",""maps"":{""googleMaps"":""https://goo.gl/maps/HgMKFQjNadF3Wa6B6"",""openStreetMaps"":""https://www.openstreetmap.org/relation/449220""},""population"":23503349,""fifa"":""TPE"",""car"":{""signs"":[""RC""],""side"":""right""},""timezones"":[""UTC+08:00""],""continents"":[""Asia""],""flags"":{""png"":""https://flagcdn.com/w320/tw.png"",""svg"":""https://flagcdn.com/tw.svg""},""coatOfArms"":{""png"":""https://mainfacts.com/media/images/coats_of_arms/tw.png"",""svg"":""https://mainfacts.com/media/images/coats_of_arms/tw.svg""},""startOfWeek"":""monday"",""capitalInfo"":{""latlng"":[25.03,121.52]},""postalCode"":{""format"":""#####"",""regex"":""^(\\d{5})$""}}]";

        string json = await restCountries.GetResponseBody();
        CountryDTO country = restCountries.GetCountryInfo(json);
        Assert.AreEqual("Republic of China (Taiwan)", country.OfficialName);
    }

    [TestMethod]
    public async Task 測試API_使用Mock()
    {
        string url = @$"https://api.jikan.moe/v4/anime/47917";
        Jikan jikan = new Jikan(new MyHttpClientMock());
        string json = await jikan.GetResponseBody(url);
        AnimeDTO? anime = jikan.GetAnimeInfo(json);

        Assert.AreEqual("Bocchi the Rock!", anime?.Title_English);
    }

    [TestMethod]
    public async Task 測試API_使用NSubstitute產生Mock()
    {
        string url = @"https://api.jikan.moe/v4/anime/47917";

        var MyHttpClientMock = Substitute.For<IHttpClient>();
        MyHttpClientMock.GetResponseBody(url).Returns(@"{""data"":{""mal_id"":47917,""url"":""https:\/\/myanimelist.net\/anime\/47917\/Bocchi_the_Rock"",""images"":{""jpg"":{""image_url"":""https:\/\/cdn.myanimelist.net\/images\/anime\/1448\/127956.jpg"",""small_image_url"":""https:\/\/cdn.myanimelist.net\/images\/anime\/1448\/127956t.jpg"",""large_image_url"":""https:\/\/cdn.myanimelist.net\/images\/anime\/1448\/127956l.jpg""},""webp"":{""image_url"":""https:\/\/cdn.myanimelist.net\/images\/anime\/1448\/127956.webp"",""small_image_url"":""https:\/\/cdn.myanimelist.net\/images\/anime\/1448\/127956t.webp"",""large_image_url"":""https:\/\/cdn.myanimelist.net\/images\/anime\/1448\/127956l.webp""}},""trailer"":{""youtube_id"":""Fp7lnCp_LW0"",""url"":""https:\/\/www.youtube.com\/watch?v=Fp7lnCp_LW0"",""embed_url"":""https:\/\/www.youtube.com\/embed\/Fp7lnCp_LW0?enablejsapi=1&wmode=opaque&autoplay=1"",""images"":{""image_url"":""https:\/\/img.youtube.com\/vi\/Fp7lnCp_LW0\/default.jpg"",""small_image_url"":""https:\/\/img.youtube.com\/vi\/Fp7lnCp_LW0\/sddefault.jpg"",""medium_image_url"":""https:\/\/img.youtube.com\/vi\/Fp7lnCp_LW0\/mqdefault.jpg"",""large_image_url"":""https:\/\/img.youtube.com\/vi\/Fp7lnCp_LW0\/hqdefault.jpg"",""maximum_image_url"":""https:\/\/img.youtube.com\/vi\/Fp7lnCp_LW0\/maxresdefault.jpg""}},""approved"":true,""titles"":[{""type"":""Default"",""title"":""Bocchi the Rock!""},{""type"":""Japanese"",""title"":""\u307c\u3063\u3061\u30fb\u3056\u30fb\u308d\u3063\u304f\uff01""},{""type"":""English"",""title"":""Bocchi the Rock!""}],""title"":""Bocchi the Rock!"",""title_english"":""Bocchi the Rock!"",""title_japanese"":""\u307c\u3063\u3061\u30fb\u3056\u30fb\u308d\u3063\u304f\uff01"",""title_synonyms"":[],""type"":""TV"",""source"":""4-koma manga"",""episodes"":12,""status"":""Finished Airing"",""airing"":false,""aired"":{""from"":""2022-10-09T00:00:00+00:00"",""to"":""2022-12-25T00:00:00+00:00"",""prop"":{""from"":{""day"":9,""month"":10,""year"":2022},""to"":{""day"":25,""month"":12,""year"":2022}},""string"":""Oct 9, 2022 to Dec 25, 2022""},""duration"":""23 min per ep"",""rating"":""PG-13 - Teens 13 or older"",""score"":8.82,""scored_by"":286592,""rank"":28,""popularity"":444,""members"":483144,""favorites"":23593,""synopsis"":""Yearning to make friends and perform live with a band, lonely and socially anxious Hitori \""Bocchi\"" Gotou devotes her time to playing the guitar. On a fateful day, Bocchi meets the outgoing drummer Nijika Ijichi, who invites her to join Kessoku Band when their guitarist, Ikuyo Kita, flees before their first show. Soon after, Bocchi meets her final bandmate\u2014the cool bassist Ryou Yamada. \n\nAlthough their first performance together is subpar, the girls feel empowered by their shared love for music, and they are soon rejoined by Kita. Finding happiness in performing, Bocchi and her bandmates put their hearts into improving as musicians while making the most of their fleeting high school days.\n\n[Written by MAL Rewrite]"",""background"":""Bocchi the Rock! was released on Blu-ray and DVD in six volumes from December 28, 2022, to May 24, 2023."",""season"":""fall"",""year"":2022,""broadcast"":{""day"":""Sundays"",""time"":""00:00"",""timezone"":""Asia\/Tokyo"",""string"":""Sundays at 00:00 (JST)""},""producers"":[{""mal_id"":17,""type"":""anime"",""name"":""Aniplex"",""url"":""https:\/\/myanimelist.net\/anime\/producer\/17\/Aniplex""},{""mal_id"":797,""type"":""anime"",""name"":""Houbunsha"",""url"":""https:\/\/myanimelist.net\/anime\/producer\/797\/Houbunsha""}],""licensors"":[],""studios"":[{""mal_id"":1835,""type"":""anime"",""name"":""CloverWorks"",""url"":""https:\/\/myanimelist.net\/anime\/producer\/1835\/CloverWorks""}],""genres"":[{""mal_id"":4,""type"":""anime"",""name"":""Comedy"",""url"":""https:\/\/myanimelist.net\/anime\/genre\/4\/Comedy""}],""explicit_genres"":[],""themes"":[{""mal_id"":52,""type"":""anime"",""name"":""CGDCT"",""url"":""https:\/\/myanimelist.net\/anime\/genre\/52\/CGDCT""},{""mal_id"":19,""type"":""anime"",""name"":""Music"",""url"":""https:\/\/myanimelist.net\/anime\/genre\/19\/Music""}],""demographics"":[]}}");

        Jikan jikan = new Jikan(MyHttpClientMock);
        string json = await MyHttpClientMock.GetResponseBody(url);
        AnimeDTO? anime = jikan.GetAnimeInfo(json);

        Assert.AreEqual("Bocchi the Rock!", anime?.Title_English);
    }

    [TestMethod]
    public async Task 測試API_測試含Internal屬性的方法(){
        string url = @"https://www.instagram.com/keelungtravel/?__a=1&__d=dis";

        var MyHttpClientMock = Substitute.For<IHttpClient>();
        IHttpClientFactory._httpClient= MyHttpClientMock;

        MyHttpClientMock.GetResponseBody(url).Returns(@"{""logging_page_id"": ""profilePage_52468201915"",""show_suggested_profiles"": false,""graphql"": {""user"": {""ai_agent_type"": null,""biography"": ""我們是一群積極推廣基隆旅遊的團隊☀️\n本粉絲團由基隆市政府維護管理\n🦅\n.\n#基隆 #旅遊 #美食 #人文 #歷史\n#基隆旅遊 #基隆美食"",""bio_links"": [{""title"": ""基隆旅遊網Facebook粉專"",""lynx_url"": ""https://l.instagram.com/?u=https%3A%2F%2Fm.facebook.com%2F100064855474130%2F&e=AT1c6ToAMxt_35Fcxj1PqnCJ9BpiUkY-TlpSw-8NwwksKVWiXarthNW0dmQyBeZEQPqEVTxwcYWSH_BbjWn1r4ZlknA0JtZH"",""url"": ""https://m.facebook.com/100064855474130/"",""link_type"": ""external""}],""fb_profile_biolink"": null,""blocked_by_viewer"": false,""restricted_by_viewer"": null,""country_block"": false,""eimu_id"": ""17848680707745916"",""external_url"": ""https://m.facebook.com/100064855474130/"",""external_url_linkshimmed"": ""https://l.instagram.com/?u=https%3A%2F%2Fm.facebook.com%2F100064855474130%2F&e=AT0lLFl3Hgogvv_uel2tvCOfd643LjH14sNFCbYMLOhXoxbKN0yI6o4haMOIeZ7HXLjJYHF7zRvzjyMzoyTKjH98Mt99SkrX"",""edge_followed_by"": {""count"": 1327},""fbid"": ""17841452377468525"",""full_name"": ""基隆旅遊網"",""id"": ""52468201915"",""username"": ""keelungtravel"",""edge_owner_to_timeline_media"": {""count"": 283,""page_info"": {""has_next_page"": true,""end_cursor"": ""QVFDWUR2V2JkNGNGalA0OTFxLWlhaWxwLXlLeUpZLTdUd0p6OFgydUZXdDVHTFk3SW5yV1hHbDZEVXhlQmllbUFhX2VxNGVQRXdNUUFGRnNTLU1iRTdERA==""},""edges"": [{""node"": {""__typename"": ""GraphSidecar"",""id"": ""3216742998147263999"",""shortcode"": ""CykKra6Su3_"",""dimensions"": {""height"": 1080,""width"": 1080},""display_url"": ""https://instagram.ftpe8-4.fna.fbcdn.net/v/t51.2885-15/393148251_703675704596812_1286544145701426880_n.jpg?stp=dst-jpg_e15_fr_s1080x1080&_nc_ht=instagram.ftpe8-4.fna.fbcdn.net&_nc_cat=104&_nc_ohc=guL-ov5y86AAX8CVF9W&edm=AKEQFekBAAAA&ccb=7-5&oh=00_AfDceMntAXBGIXL5E9FQ-bFyQCYgJKzYo5rnGV5951Hw8w&oe=65352BE9&_nc_sid=29ddf3"",""edge_media_to_tagged_user"": {""edges"": []},""fact_check_overall_rating"": null,""fact_check_information"": null,""gating_info"": null,""sharing_friction_info"": {""should_have_sharing_friction"": false,""bloks_app_url"": null},""media_overlay_info"": null,""media_preview"": null,""owner"": {""id"": ""52468201915"",""username"": ""keelungtravel""},""is_video"": false,""has_upcoming_event"": false,""accessibility_caption"": null,""edge_media_to_caption"": {""edges"": [{""node"": {""text"": ""位於正濱漁港斜對面的 #閑閑咖啡\n二樓可以直接欣賞正濱漁港色彩屋🤩\n招牌布丁蛋糕捲是許多人的必點🍮\n有時間就到這悠閒的待上一個下午吧‼\n\n閑閑：https://www.facebook.com/siansian40\n-\n更多旅遊詳情歡迎關注\n 📍📍 #基隆旅遊網\n.\n#基隆 #景點 #旅遊 #美食 #台灣 #臺灣 #Taiwan #Keelung #travel #view #tour""}}]},""edge_media_to_comment"": {""count"": 0},""comments_disabled"": false,""taken_at_timestamp"": 1697685669,""edge_liked_by"": {""count"": 4},""edge_media_preview_like"": {""count"": 4},""location"": null,""nft_asset_info"": null,""thumbnail_src"": ""https://instagram.ftpe8-4.fna.fbcdn.net/v/t51.2885-15/393148251_703675704596812_1286544145701426880_n.jpg?stp=dst-jpg_e35_s640x640_sh0.08&_nc_ht=instagram.ftpe8-4.fna.fbcdn.net&_nc_cat=104&_nc_ohc=guL-ov5y86AAX8CVF9W&edm=AKEQFekBAAAA&ccb=7-5&oh=00_AfDwPrAj9umTWovLckfQkuhCHCNRMwNtJT_mFMH2_F0A1w&oe=65352BE9&_nc_sid=29ddf3"",""thumbnail_resources"": [{""src"": ""https://instagram.ftpe8-4.fna.fbcdn.net/v/t51.2885-15/393148251_703675704596812_1286544145701426880_n.jpg?stp=dst-jpg_e15_s150x150&_nc_ht=instagram.ftpe8-4.fna.fbcdn.net&_nc_cat=104&_nc_ohc=guL-ov5y86AAX8CVF9W&edm=AKEQFekBAAAA&ccb=7-5&oh=00_AfAZkA76tGKVzqwq3JbusVfycIWOd88ZtEJeGqvZv_rXsQ&oe=65352BE9&_nc_sid=29ddf3"",""config_width"": 150,""config_height"": 150},{""src"": ""https://instagram.ftpe8-4.fna.fbcdn.net/v/t51.2885-15/393148251_703675704596812_1286544145701426880_n.jpg?stp=dst-jpg_e15_s240x240&_nc_ht=instagram.ftpe8-4.fna.fbcdn.net&_nc_cat=104&_nc_ohc=guL-ov5y86AAX8CVF9W&edm=AKEQFekBAAAA&ccb=7-5&oh=00_AfD_4Sx4z1UeYx74jj7qwue8whh96aXnncz2IJrTmI31hw&oe=65352BE9&_nc_sid=29ddf3"",""config_width"": 240,""config_height"": 240},{""src"": ""https://instagram.ftpe8-4.fna.fbcdn.net/v/t51.2885-15/393148251_703675704596812_1286544145701426880_n.jpg?stp=dst-jpg_e15_s320x320&_nc_ht=instagram.ftpe8-4.fna.fbcdn.net&_nc_cat=104&_nc_ohc=guL-ov5y86AAX8CVF9W&edm=AKEQFekBAAAA&ccb=7-5&oh=00_AfD8ZS0nzo8WgalkZKEbm7QYFkHnTKRsyBkexPISP5XzSA&oe=65352BE9&_nc_sid=29ddf3"",""config_width"": 320,""config_height"": 320},{""src"": ""https://instagram.ftpe8-4.fna.fbcdn.net/v/t51.2885-15/393148251_703675704596812_1286544145701426880_n.jpg?stp=dst-jpg_e15_s480x480&_nc_ht=instagram.ftpe8-4.fna.fbcdn.net&_nc_cat=104&_nc_ohc=guL-ov5y86AAX8CVF9W&edm=AKEQFekBAAAA&ccb=7-5&oh=00_AfCVLLeUK7sn6Q9yu5cxeETPqwPQwzyvB-yJhH2F13fOOw&oe=65352BE9&_nc_sid=29ddf3"",""config_width"": 480,""config_height"": 480},{""src"": ""https://instagram.ftpe8-4.fna.fbcdn.net/v/t51.2885-15/393148251_703675704596812_1286544145701426880_n.jpg?stp=dst-jpg_e35_s640x640_sh0.08&_nc_ht=instagram.ftpe8-4.fna.fbcdn.net&_nc_cat=104&_nc_ohc=guL-ov5y86AAX8CVF9W&edm=AKEQFekBAAAA&ccb=7-5&oh=00_AfDwPrAj9umTWovLckfQkuhCHCNRMwNtJT_mFMH2_F0A1w&oe=65352BE9&_nc_sid=29ddf3"",""config_width"": 640,""config_height"": 640}],""coauthor_producers"": [],""pinned_for_users"": [],""viewer_can_reshare"": true,""edge_sidecar_to_children"": {""edges"": [{""node"": {""__typename"": ""GraphImage"",""id"": ""3216742991260070768"",""shortcode"": ""CykKrUfyLNw"",""dimensions"": {""height"": 1080,""width"": 1080},""display_url"": ""https://instagram.ftpe8-4.fna.fbcdn.net/v/t51.2885-15/393148251_703675704596812_1286544145701426880_n.jpg?stp=dst-jpg_e15_fr_s1080x1080&_nc_ht=instagram.ftpe8-4.fna.fbcdn.net&_nc_cat=104&_nc_ohc=guL-ov5y86AAX8CVF9W&edm=AKEQFekBAAAA&ccb=7-5&oh=00_AfDceMntAXBGIXL5E9FQ-bFyQCYgJKzYo5rnGV5951Hw8w&oe=65352BE9&_nc_sid=29ddf3"",""edge_media_to_tagged_user"": {""edges"": []},""fact_check_overall_rating"": null,""fact_check_information"": null,""gating_info"": null,""sharing_friction_info"": {""should_have_sharing_friction"": false,""bloks_app_url"": null},""media_overlay_info"": null,""media_preview"": ""ACoqYOeacDiogacWAGc1ncuw8PVuI96oBgeR0NTq5HSjmQ+Vlt/aosmnCQsOaMU7pis0ZOfWnNKqouOvO7+gpOD0604RL1PNc/qbtdi3GqGMu3y5AwDxyO4FNVgVDDnsfY//AFxyKryRHytyjqakWMxg4/iAyD7f5603ZCRcWQDrxUm+q6qR9449qXePSgCiqGpdoxzSrzSGpKGLMUyhBKN6dRUsV3j721sd+c/lio+34igCquTYe8pkbdSbhTTSUwP/2Q=="",""owner"": {""id"": ""52468201915"",""username"": ""keelungtravel""},""is_video"": false,""has_upcoming_event"": false,""accessibility_caption"": null}},{""node"": {""__typename"": ""GraphImage"",""id"": ""3216742991260243366"",""shortcode"": ""CykKrUfy1Wm"",""dimensions"": {""height"": 1080,""width"": 1080},""display_url"": ""https://instagram.ftpe8-2.fna.fbcdn.net/v/t51.2885-15/392941151_361025456462439_4185624378481163893_n.jpg?stp=dst-jpg_e15_fr_s1080x1080&_nc_ht=instagram.ftpe8-2.fna.fbcdn.net&_nc_cat=103&_nc_ohc=nYjtHNd10mEAX9dZhmT&edm=AKEQFekBAAAA&ccb=7-5&oh=00_AfDp7xF9OB7JOiNyUsnTlF8s0tf3B8b8V3UTgeQu53fJOg&oe=6535D8E8&_nc_sid=29ddf3"",""edge_media_to_tagged_user"": {""edges"": []},""fact_check_overall_rating"": null,""fact_check_information"": null,""gating_info"": null,""sharing_friction_info"": {""should_have_sharing_friction"": false,""bloks_app_url"": null},""media_overlay_info"": null,""media_preview"": ""ACoqWx5T8v61oRH5F+lZ9gP3Wf8APerMM5VQCMjFVF6smWxZbofoaz4o1lbYwBHPB/Cr5dGU7T2PB69Kz7cMX+U7fvc4B9OOacnewo9SssQSV0T7qtwDzjirWxv8iq8eTJITyd556fpV/eayNSGxH7rH+e9QCWNRhmUEds80nOKyJhhz9TTRLNpZ4vuqwJPvz9OlItwLds43dRgEDHPvWHGcOPrVyfliabBInhnUM7NxuYtjr1+lT/af939f8KyUUsTgZqxsapKLxNYshLOcep/nWo3f6VmmhBuMVSDmrZy46HNSW4GRV8gUwMoRMDmrG5/8mrJFQnrWci4n/9k="",""owner"": {""id"": ""52468201915"",""username"": ""keelungtravel""},""is_video"": false,""has_upcoming_event"": false,""accessibility_caption"": null}}]}}}]}}}}");

        Instagram instagram = new Instagram();
        string json = await MyHttpClientMock.GetResponseBody(url);
        instagram.GetInstagramInfo(json);
    }
}